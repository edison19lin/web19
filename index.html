<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>é›»ç«ç™¼æ˜å®¶</title>
  <style>
    :root{ --bg:#0b1220;--panel:#0f172a;--panel-2:#0c1427;--text:#e5e7eb;--muted:#9ca3af;--accent:#60a5fa;--border:#1f2a44;--hover:#15213a; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--text);
      font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans TC",sans-serif
    }

    /* ç‰ˆé¢ï¼šç¬¬äºŒåˆ—æ”¹ç‚º autoï¼Œè®“å…§å®¹è‡ªç„¶å¢é«˜ï¼›äº¤çµ¦æ•´é æ»¾å‹• */
    .app{
      display:grid;
      grid-template-columns:280px 1fr;
      grid-template-rows:56px auto; /* â† æ”¹ç‚º auto */
      min-height:100vh;
    }
    header{grid-column:1/3;display:flex;align-items:center;gap:12px;padding:10px 16px;background:var(--panel);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:1100}
    header h1{font-size:18px;margin:0;font-weight:600}
    header .search{flex:1;max-width:720px;display:flex;gap:8px}
    input[type="search"]{flex:1;background:#0a1223;border:1px solid var(--border);border-radius:10px;padding:10px 12px;color:var(--text)}
    aside{background:var(--panel);border-right:1px solid var(--border);overflow:auto}
    main{background:linear-gradient(180deg,var(--panel-2),var(--panel));overflow:visible} /* â† æ”¹ç‚º visible */

    /* Tree */
    .tree{list-style:none;margin:0;padding:8px}
    .node{margin:2px 0;border-radius:10px}
    .node>.row{display:flex;align-items:center;gap:8px;padding:8px 10px;border-radius:10px;cursor:pointer}
    .node>.row:hover{background:var(--hover)}
    .caret{transition:transform .2s ease}
    .collapsed>.row .caret{transform:rotate(-90deg)}
    .children{margin-left:20px;padding-left:8px;border-left:1px dashed var(--border)}
    .children.collapsed{display:none}
    .title{flex:1}
    .badge{font-size:12px;color:var(--muted)}
    .file{display:flex;align-items:center;gap:8px;padding:6px 12px;margin:2px 0;border-radius:10px;cursor:pointer}
    .file:hover{background:var(--hover)}
    .file.active{background:rgba(96,165,250,.15);outline:1px solid rgba(96,165,250,.35)}

    /* Contentï¼šæ–‡ç« å€ä½” 95% å¯¬ */
    .content{width:95%;max-width:none;margin:24px auto;padding:0}
    .breadcrumbs{font-size:14px;color:var(--muted);margin-bottom:8px}
    .breadcrumbs a{color:var(--muted);text-decoration:none}
    .breadcrumbs a:hover{color:var(--text)}
    h2.article-title{margin:8px 0 16px;font-size:26px}
    .toolbar{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin:6px 0 16px}
    .btn{background:#0a1223;border:1px solid var(--border);padding:8px 10px;border-radius:10px;color:var(--text);cursor:pointer}
    .btn:hover{background:#0d1830}

    /* Iframe container */
    #articleFrame{
      width:100%;border:0;min-height:420px;background:#0b1326;
      border:1px solid var(--border);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.35);
      overflow:hidden; /* é¿å…é¡¯ç¤º iframe æ²è»¸ï¼Œé  JS è‡ªå‹•æ’é«˜ */
      display:none;
    }
    .welcome{background:#0b1326;border:1px solid var(--border);border-radius:14px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.35)}

    /* ===== éš±è—å´æ¬„ç‹€æ…‹ï¼ˆåƒ…æ¡Œæ©Ÿå¥—ç”¨ï¼‰ ===== */
    @media (min-width: 901px){
      body.sidebar-hidden aside{ display:none; }
    }

    /* Responsiveï¼šæ‰‹æ©ŸæŠ½å±œåŒ– */
    .toggle{display:none}
    @media (max-width: 900px){
      .app{grid-template-columns:1fr;grid-template-rows:56px auto 1fr}
      aside{grid-row:2;display:none}
      aside.open{
        display:block !important;      /* å¼·åˆ¶é¡¯ç¤º */
        position:fixed;                /* æŠ½å±œå®šä½ */
        top:56px; left:0; bottom:0;
        width:80vw; max-width:320px;
        z-index:1000;                  /* è“‹é main */
        overflow:auto;
      }
      .toggle{display:inline-flex;margin-right:6px}
      header{gap:8px}
      header h1{display:none}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <button class="btn toggle" id="toggleSidebar" aria-label="é–‹é—œé¸å–®" aria-expanded="false" aria-controls="sidebar">â˜° é¸å–®</button>
      <h1>æ–‡ç« åº«</h1>
      <div class="search">
        <input id="searchInput" type="search" placeholder="æœå°‹åˆ†é¡æˆ–æ–‡ç« æ¨™é¡Œâ€¦" />
      </div>
      <button class="btn" id="expandAll">å±•é–‹</button>
      <button class="btn" id="collapseAll">æ”¶åˆ</button>
      <button class="btn" id="hideSidebarBtn" aria-expanded="true" aria-controls="sidebar">éš±è—é¸å–®</button>
    </header>

    <aside id="sidebar">
      <ul class="tree" id="treeRoot"></ul>
    </aside>

    <main>
      <div class="content">
        <div class="breadcrumbs" id="breadcrumbs">é¦–é </div>
        <h2 class="article-title" id="articleTitle">æ­¡è¿ï¼</h2>
        <div class="toolbar">
          <button class="btn" id="openRaw">åœ¨æ–°åˆ†é é–‹å•ŸåŸå§‹æª”</button>
          <button class="btn" id="copyLink">è¤‡è£½ç›®å‰é€£çµ</button>
        </div>

        <!-- åˆå§‹æ­¡è¿å¡ç‰‡ï¼ˆå°šæœªé¸æ–‡ç« æ™‚é¡¯ç¤ºï¼‰ -->
        <div id="welcome" class="welcome">
          <p>å·¦å´æ˜¯ã€Œé¡æª”æ¡ˆç¸½ç®¡ã€çš„é¸å–®ã€‚é»åˆ†é¡å¯å±•é–‹ï¼Œé»æ–‡ç« æœƒåœ¨ä¸‹æ–¹çš„ iframe è¼‰å…¥å…§å®¹ï¼ˆæ–‡ç« è‡ªå¸¶ CSS/JS å½¼æ­¤éš”é›¢ï¼Œä¸æœƒå½±éŸ¿ç‰ˆé¢ï¼‰ã€‚</p>
          <pre><code>personal/
  intro.html
  genealogy.html
  photos.html
notes/
  c/index.html
  python/index.html
  vscode/index.html</code></pre>
        </div>

        <!-- æ–‡ç«  iframeï¼šé¸æ“‡æ–‡ç« å¾Œæ‰æœƒé¡¯ç¤º -->
        <iframe id="articleFrame" title="æ–‡ç« å…§å®¹"></iframe>

        <!-- Disqus ç•™è¨€ï¼ˆæœƒä¾ç›®å‰æ–‡ç«  path é‡è¨­ï¼‰ -->
        <div id="disqus_thread" style="margin-top:24px;"></div>
        <noscript>è«‹å•Ÿç”¨ JavaScript ä»¥æª¢è¦– <a href="https://disqus.com/" rel="nofollow">Disqus ç•™è¨€å€</a></noscript>
      </div>
    </main>
  </div>

  <script>
    // ===== 1) ç«™é»æ¸…å–®ï¼ˆé€™è£¡å¡«ä½ çš„åˆ†é¡/é é¢ï¼‰ ===============================
    const manifest = [
      { name: 'å€‹äººç›¸é—œè³‡æ–™', children: [
        { title: 'å€‹äººä»‹ç´¹', path: 'personal/intro.html' },
        { title: 'ç¥–è­œï¼ˆå®¶æ—æ¨¹ï¼‰', path: 'personal/genealogy.html' },
        { title: 'ç…§ç‰‡ç›¸ç°¿', path: 'personal/photos.html' },
      ]},
      { name: 'æŠ€è¡“ç­†è¨˜', children: [
        { title: 'C èªè¨€', path: 'notes/c/index.html' },
        { title: 'Python', path: 'notes/python/index.html' },
        { title: 'VS Code', path: 'notes/vscode/index.html' },
      ]},
    ];

    // ===== 2) UI å…ƒä»¶ =======================================================
    const treeRoot = document.getElementById('treeRoot');
    const breadcrumbs = document.getElementById('breadcrumbs');
    const articleTitle = document.getElementById('articleTitle');
    const openRawBtn = document.getElementById('openRaw');
    const copyLinkBtn = document.getElementById('copyLink');
    const sidebar = document.getElementById('sidebar');
    const welcome = document.getElementById('welcome');
    const frame = document.getElementById('articleFrame');

    let currentPath = null; // ç›®å‰æ–‡ç« è·¯å¾‘ï¼ˆçµ¦ Disqus ä½¿ç”¨ï¼‰

    function createCategoryNode(cat, pathTrail=[]) {
      const li = document.createElement('li');
      li.className = 'node';
      li.dataset.type = 'category';

      const row = document.createElement('div');
      row.className = 'row';
      const caret = document.createElement('span');
      caret.className = 'caret';
      caret.textContent = 'â–¾';
      const folder = document.createElement('span');
      folder.textContent = 'ğŸ“‚';
      const title = document.createElement('span');
      title.className = 'title';
      title.textContent = cat.name;
      const badge = document.createElement('span');
      badge.className = 'badge';
      badge.textContent = countItems(cat);

      row.append(caret, folder, title, badge);
      li.appendChild(row);

      const ul = document.createElement('ul');
      ul.className = 'children';
      (cat.children||[]).forEach(ch => {
        if (ch.path) ul.appendChild(createFileNode(ch, [...pathTrail, cat.name]));
        else ul.appendChild(createCategoryNode(ch, [...pathTrail, cat.name]));
      });
      li.appendChild(ul);

      row.addEventListener('click', () => {
        ul.classList.toggle('collapsed');
        li.classList.toggle('collapsed');
      });
      return li;
    }

    function createFileNode(item, pathTrail=[]) {
      const li = document.createElement('li');
      li.className = 'file';
      li.dataset.type = 'file';
      li.dataset.title = item.title;
      li.dataset.path = item.path;
      li.dataset.trail = JSON.stringify(pathTrail);

      const icon = document.createElement('span');
      icon.textContent = 'ğŸ“„';
      const span = document.createElement('span');
      span.className = 'title';
      span.textContent = item.title;
      li.append(icon, span);

      li.addEventListener('click', () => {
        document.querySelectorAll('.file.active').forEach(n=>n.classList.remove('active'));
        li.classList.add('active');
        loadArticle(item.title, item.path, pathTrail);
        if (window.innerWidth < 900) sidebar.classList.remove('open');
      });
      return li;
    }

    function countItems(node){
      if (node.path) return 1;
      return (node.children||[]).reduce((a,n)=>a+countItems(n),0);
    }

    function buildTree(){
      treeRoot.innerHTML='';
      manifest.forEach(cat=> treeRoot.appendChild(createCategoryNode(cat)));
    }

    // ===== 3) è¼‰å…¥æ–‡ç« ï¼ˆiframe ç‰ˆï¼‰ + å°è¦½ ==================================
    async function loadArticle(title, path, trail){
      currentPath = path; window.currentPath = path; // çµ¦ disqus_config ä½¿ç”¨
      setRoute(path);
      breadcrumbs.innerHTML = ['<a href="#" data-home>é¦–é </a>']
        .concat(trail.map(t=>`<span> / </span><span>${escapeHtml(t)}</span>`))
        .concat([`<span> / </span><span>${escapeHtml(title)}</span>`])
        .join('');
      articleTitle.textContent = title;

      // é¡¯ç¤º iframeã€éš±è—æ­¡è¿å¡
      welcome.style.display = 'none';
      frame.style.display = 'block';

      // è¼‰å…¥æ–‡ç« æª”æ¡ˆ
      frame.src = path + cacheBust();
      frame.onload = () => {
        // åŒç¶²åŸŸæ™‚è‡ªå‹•é«˜åº¦
        try {
          const doc = frame.contentWindow.document;

          // ç¢ºä¿å…§é ä¸é¡¯ç¤ºè‡ªèº«æ²è»¸ï¼ˆåªé å¤–å±¤æ’é«˜ï¼‰
          try{
            doc.documentElement.style.overflowY = 'hidden';
            doc.body.style.overflowY = 'hidden';
            doc.documentElement.style.overflowX = 'hidden';
            doc.body.style.overflowX = 'hidden';
            doc.body.style.margin = '0';
          }catch(_e){}

          const h = Math.max(doc.body.scrollHeight, doc.documentElement.scrollHeight);
          frame.style.height = (h + 20) + 'px'; // ä¸è¨­ä¸‹é™ï¼Œå®Œå…¨ä¾å…§å®¹æ’é«˜
        } catch (e) {
          // è·¨ç¶²åŸŸï¼šé€€è€Œæ±‚å…¶æ¬¡çµ¦å€‹è¦–çª—é«˜åº¦
          frame.style.height = '80vh';
        }
      };

      // æŒ‰éˆ•
      openRawBtn.onclick = ()=> window.open(path, '_blank');
      copyLinkBtn.onclick = ()=>{
        navigator.clipboard.writeText(location.href).then(()=>{
          copyLinkBtn.textContent = 'å·²è¤‡è£½ï¼';
          setTimeout(()=>copyLinkBtn.textContent='è¤‡è£½ç›®å‰é€£çµ',1000);
        });
      };

      // æ›´æ–° Disqusï¼ˆå·²ç§»é™¤è¨ªå®¢è¨ˆæ•¸ï¼‰
      updateDisqus(location.href, path);
    }

    // ===== Disqusï¼šä¾ç›®å‰æ–‡ç« é‡è¨­ ===========================================
    window.disqus_config = function () {
      this.page.url = location.href;
      this.page.identifier = window.currentPath || 'home';
    };
    const DISQUS_SHORTNAME = 'edison19lin'; // â† æ”¹æˆä½ çš„ Disqus çŸ­åç¨±
    (function(){
      const d = document, s = d.createElement('script');
      s.src = 'https://' + DISQUS_SHORTNAME + '.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();

    function updateDisqus(pageUrl, identifier){
      if (window.DISQUS){
        window.DISQUS.reset({
          reload: true,
          config: function () {
            this.page.url = pageUrl;      // ç›®å‰é é¢ç¶²å€ï¼ˆå« ?path=ï¼‰
            this.page.identifier = identifier; // ä»¥æ–‡ç«  path ç•¶å”¯ä¸€ ID
          }
        });
      } else {
        setTimeout(()=> updateDisqus(pageUrl, identifier), 400);
      }
    }

    // ===== 4) æœå°‹ï¼ˆå³æ™‚éæ¿¾ï¼‰ ==============================================
    const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('input', ()=>{
      const q = searchInput.value.trim().toLowerCase();
      filterTree(q);
    });

    function filterTree(q){
      const files = treeRoot.querySelectorAll('.file');
      files.forEach(li=>{
        const match = li.dataset.title.toLowerCase().includes(q);
        li.style.display = match? 'flex':'none';
        if(match){
          let p = li.parentElement; // ul.children
          while(p && p.id !== 'treeRoot'){
            if(p.classList.contains('children')) p.classList.remove('collapsed');
            const node = p.parentElement; // li.node
            node && node.classList.remove('collapsed');
            p = node && node.parentElement;
          }
        }
      });
    }

    // ===== A) å´æ¬„é¡¯ç¤º/éš±è—ï¼ˆæ¡Œæ©Ÿ+æ‰‹æ©Ÿåˆ†æµï¼‰ ===============================
    function setSidebarHidden(hidden){
      document.body.classList.toggle('sidebar-hidden', hidden);
      const btn = document.getElementById('hideSidebarBtn');
      if (btn){
        btn.textContent = hidden ? 'é¡¯ç¤ºé¸å–®' : 'éš±è—é¸å–®';
        btn.setAttribute('aria-expanded', String(!hidden));
      }
      try{ localStorage.setItem('sidebarHidden', hidden ? '1' : '0'); }catch(e){}
    }
    function toggleSidebarHidden(){
      const nowHidden = !document.body.classList.contains('sidebar-hidden');
      setSidebarHidden(nowHidden);
    }
    // è®€å–è¨˜æ†¶ç‹€æ…‹ï¼ˆåƒ…å½±éŸ¿æ¡Œæ©Ÿè¦–åœ–ï¼‰
    (function restoreSidebarState(){
      try{
        const saved = localStorage.getItem('sidebarHidden');
        if (saved === '1') setSidebarHidden(true);
      }catch(e){}
    })();

    // ç¶å®šã€Œéš±è—/é¡¯ç¤ºé¸å–®ã€ï¼ˆæ¡Œæ©Ÿï¼‰
    document.getElementById('hideSidebarBtn').onclick = toggleSidebarHidden;

    // æ‰‹æ©Ÿç”¨çš„æ¼¢å ¡éµï¼ˆåˆ‡æ›å´æ¬„å±•é–‹/æ”¶åˆï¼‰
    document.getElementById('toggleSidebar').onclick = (e)=>{
      e.preventDefault();
      // è‹¥æ¡Œæ©Ÿæ¨¡å¼è¢«éš±è—ï¼Œå…ˆæ¢å¾©é¡¯ç¤ºï¼ˆé¿å…é–‹ä¸åˆ°ï¼‰
      if (document.body.classList.contains('sidebar-hidden')) setSidebarHidden(false);
      const isOpen = sidebar.classList.toggle('open');
      const btn = e.currentTarget;
      btn.setAttribute('aria-expanded', String(isOpen));
      btn.setAttribute('aria-controls', 'sidebar');
    };

    // é» main ç©ºç™½è™•é—œé–‰æŠ½å±œï¼ˆåƒ…æ‰‹æ©Ÿå¯¬åº¦æ™‚ï¼‰
    document.querySelector('main').addEventListener('click', ()=>{
      if (window.innerWidth <= 900 && sidebar.classList.contains('open')) {
        sidebar.classList.remove('open');
        const btn = document.getElementById('toggleSidebar');
        btn && btn.setAttribute('aria-expanded', 'false');
      }
    });

    // éµç›¤å¿«é€Ÿéµï¼šæŒ‰ä¸‹ "s" åˆ‡æ›å´æ¬„ï¼ˆé¿å…åœ¨è¼¸å…¥æ¡†è§¸ç™¼ï¼‰
    window.addEventListener('keydown', (e)=>{
      const tag = (e.target.tagName||'').toLowerCase();
      if (e.key.toLowerCase() === 's' && !/input|textarea/.test(tag)){
        e.preventDefault();
        toggleSidebarHidden();
      }
    });

    // ===== 5) åˆå§‹åŒ– ========================================================
    buildTree();

    // å¦‚æœç¶²å€æœ‰æŒ‡å®š pathï¼Œå°±ç›´æ¥è¼‰å…¥
    const startPath = getParam('path');
    if (startPath){
      function findItem(nodes, trail=[]){
        for(const n of nodes){
          if(n.path && n.path===startPath) return {title:n.title, trail};
          if(n.children){
            const f = findItem(n.children, [...trail,n.name]);
            if(f) return f;
          }
        }
        return null;
      }
      const found = findItem(manifest);
      if(found){
        loadArticle(found.title, startPath, found.trail);
        const target = [...document.querySelectorAll('.file')].find(li=>li.dataset.path===startPath);
        target && target.classList.add('active');
      }
    }

    // å±•é–‹/æ”¶åˆå…¨éƒ¨
    document.getElementById('expandAll').onclick = ()=>{
      document.querySelectorAll('.children').forEach(ul=>ul.classList.remove('collapsed'));
      document.querySelectorAll('.node').forEach(li=>li.classList.remove('collapsed'));
    }
    document.getElementById('collapseAll').onclick = ()=>{
      document.querySelectorAll('.children').forEach(ul=>ul.classList.add('collapsed'));
      document.querySelectorAll('.node').forEach(li=>li.classList.add('collapsed'));
    }

    // é»æ“ŠéºµåŒ…å±‘å›é¦–é 
    breadcrumbs.addEventListener('click', (e)=>{
      const a = e.target.closest('a[data-home]');
      if(!a) return;
      e.preventDefault();
      setRoute(null);
      articleTitle.textContent = 'æ­¡è¿ï¼';
      breadcrumbs.textContent = 'é¦–é ';
      frame.style.display = 'none';
      welcome.style.display = 'block';
      document.querySelectorAll('.file.active').forEach(n=>n.classList.remove('active'));
      currentPath = null; window.currentPath = 'home';
      updateDisqus(location.href, 'home');
    });

    // å°å·¥å…·å€‘
    function getParam(name){ const u = new URL(location.href); return u.searchParams.get(name); }
    function setRoute(path){ const u = new URL(location.href); if (path) u.searchParams.set('path', path); else u.searchParams.delete('path'); history.replaceState({}, '', u); }
    function cacheBust(){ return (location.hostname.endsWith('pcloud.link')? `?v=${Date.now()}` : ''); }
    function escapeHtml(s){ return s.replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c])); }
  </script>
</body>
</html>